version: '3.8'

services:
  # Jupyter Notebook æœåŠ¡ - ç”¨äºå¼€å‘å’Œæ¢ç´¢
  jupyter:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: agents-jupyter
    ports:
      - "8888:8888"  # Jupyter Notebook
    volumes:
      - ./notebooks:/app/notebooks
      - ./src:/app/src
      - ./tests:/app/tests
      - ./data:/app/data  # ç”¨äºå­˜å‚¨æ•°æ®
      - ./logs:/app/logs  # ç”¨äºå­˜å‚¨æ—¥å¿—
    environment:
      - PYTHONPATH=/app
      - LANGSMITH_API_KEY=${LANGSMITH_API_KEY}
      - LANGSMITH_TRACING=${LANGSMITH_TRACING:-true}
      - LANGSMITH_PROJECT=${LANGSMITH_PROJECT:-interrupt-workshop}
      - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
      - AZURE_OPENAI_API_VERSION=${AZURE_OPENAI_API_VERSION}
      - AZURE_OPENAI_DEPLOYMENT_NAME=${AZURE_OPENAI_DEPLOYMENT_NAME}
      - GOOGLE_APPLICATION_CREDENTIALS=${GOOGLE_APPLICATION_CREDENTIALS}
      # æ·»åŠ æ ‡å‡†ç¯å¢ƒå˜é‡åä»¥å…¼å®¹ LangChain
      - OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - OPENAI_API_VERSION=${AZURE_OPENAI_API_VERSION}
      - OPENAI_API_BASE=${AZURE_OPENAI_ENDPOINT}
      - AZURE_OPENAI_DEPLOYMENT=${AZURE_OPENAI_DEPLOYMENT_NAME}
    env_file:
      - .env
    command: >
      sh -c "
        echo 'ğŸ§ª Starting Jupyter Notebook...' &&
        echo 'ğŸ“ Jupyter Notebook: http://localhost:8888' &&
        cd /app && .venv/bin/jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser --allow-root --NotebookApp.token='' --NotebookApp.password='' --NotebookApp.allow_origin='*'
      "
    restart: unless-stopped
    networks:
      - agents-network

  # LangGraph Dev Server - ç”¨äºè°ƒè¯•å’Œå¯è§†åŒ–
  langgraph-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: agents-langgraph-dev
    network_mode: host
    volumes:
      - ./langgraph.json:/app/langgraph.json
      - ./src:/app/src
      - ./notebooks:/app/notebooks
      - ./tests:/app/tests
      - ./data:/app/data
      - ./logs:/app/logs
    environment:
      - PYTHONPATH=/app
      - LANGSMITH_API_KEY=${LANGSMITH_API_KEY}
      - LANGSMITH_TRACING=${LANGSMITH_TRACING:-true}
      - LANGSMITH_PROJECT=${LANGSMITH_PROJECT:-interrupt-workshop}
      - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
      - AZURE_OPENAI_API_VERSION=${AZURE_OPENAI_API_VERSION}
      - AZURE_OPENAI_DEPLOYMENT_NAME=${AZURE_OPENAI_DEPLOYMENT_NAME}
      # æ·»åŠ æ ‡å‡†ç¯å¢ƒå˜é‡åä»¥å…¼å®¹ LangChain
      - OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
      - OPENAI_API_VERSION=${AZURE_OPENAI_API_VERSION}
      - OPENAI_API_BASE=${AZURE_OPENAI_ENDPOINT}
      - AZURE_OPENAI_DEPLOYMENT=${AZURE_OPENAI_DEPLOYMENT_NAME}
    env_file:
      - .env
    command: >
      sh -c "
        echo 'ğŸš€ Starting LangGraph Dev Server...' &&
        echo 'ğŸ“Š LangGraph Dev Server: http://localhost:8123' &&
        cd /app &&
        export PATH=\"/app/.venv/bin:\$PATH\" &&
        export HOST=0.0.0.0 &&
        /app/.venv/bin/langgraph dev --config langgraph.json --port 8123 --no-browser
      "
    restart: unless-stopped
    profiles:
      - dev  # ä½¿ç”¨ profile æ¥æ§åˆ¶æ˜¯å¦å¯åŠ¨

  # å¯é€‰ï¼šæ·»åŠ  LangGraph Studio æœåŠ¡
  # æ³¨æ„ï¼šç”±äºé•œåƒæ‹‰å–é—®é¢˜ï¼ŒLangGraph Studio æš‚ä¸å¯ç”¨
  # å¦‚æœéœ€è¦ä½¿ç”¨ï¼Œè¯·æ‰‹åŠ¨å®‰è£…æˆ–åœ¨å®¹å™¨å†…å¯åŠ¨
  # langgraph-studio:
  #   image: langchain/langgraph-studio:latest
  #   container_name: langgraph-studio
  #   ports:
  #     - "8000:8000"
  #   volumes:
  #     - ./langgraph.json:/app/langgraph.json
  #     - ./src:/app/src
  #     - ./.env:/app/.env
  #   environment:
  #     - LANGSMITH_API_KEY=${LANGSMITH_API_KEY}
  #     - LANGSMITH_TRACING=${LANGSMITH_TRACING:-true}
  #     - LANGSMITH_PROJECT=${LANGSMITH_PROJECT:-interrupt-workshop}
  #     - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}
  #     - AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
  #     - AZURE_OPENAI_API_VERSION=${AZURE_OPENAI_API_VERSION}
  #     - AZURE_OPENAI_DEPLOYMENT_NAME=${AZURE_OPENAI_DEPLOYMENT_NAME}
  #   env_file:
  #     - .env
  #   depends_on:
  #     - email-assistant
  #   restart: unless-stopped
  #   networks:
  #     - agents-network
  #   profiles:
  #     - studio  # ä½¿ç”¨ profile æ¥æ§åˆ¶æ˜¯å¦å¯åŠ¨

networks:
  agents-network:
    driver: bridge

volumes:
  data:
  logs:



